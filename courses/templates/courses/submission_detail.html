{% extends "base.html" %}
{% block title %}Submission #{{ submission.pk }} — StudentCourses{% endblock %}
{% block content %}
<div class="row mt-3">
  <div class="col-md-8">
    <h3>{{ submission.course.title }}</h3>
    <p class="small text-muted">Student: {{ submission.student }} • Submitted: {{ submission.submitted_at|date:"M d, Y H:i" }}</p>
    <hr>

    <p><strong>File:</strong>
      {% if submission.file %}
        <a href="{{ submission.file.url }}" target="_blank">Download PDF</a>
      {% else %}
        <span class="text-muted">No file attached.</span>
      {% endif %}
    </p>

    <p><strong>Graded:</strong> {% if submission.graded %}Yes ({{ submission.grade }}){% else %}No{% endif %}</p>

    {% if submission.feedback %}
      <div class="mt-3">
        <h5>Feedback</h5>
        <div class="border p-3">{{ submission.feedback|linebreaks }}</div>
      </div>
    {% endif %}

    {# Instructor grading UI: show only to course instructor or superuser #}
    {% if can_grade %}
      <hr>
      <div class="mt-3">
        <!-- Button to toggle the grading form -->
        <button class="btn btn-warning mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#gradeForm" aria-expanded="false" aria-controls="gradeForm">
          {% if submission.graded %}Edit Grade{% else %}Grade Submission{% endif %}
        </button>

        <!-- Inline grading form (Bootstrap collapse) -->
        <div class="collapse" id="gradeForm">
          <div class="card card-body">
            <form method="post" action="{% url 'courses:grade_submission' submission.pk %}">
              {% csrf_token %}
              <div class="mb-3">
                <label class="form-label">Grade</label>
                <input type="text" name="grade" value="{{ submission.grade|default:'' }}" class="form-control" placeholder="e.g. A, 95, 18/20" required>
                <div class="form-text">Free-text grade (letter/number) — change as your grading scheme.</div>
              </div>

              <div class="mb-3">
                <label class="form-label">Feedback (optional)</label>
                <textarea name="feedback" rows="5" class="form-control" placeholder="Provide feedback for the student...">{{ submission.feedback|default:'' }}</textarea>
              </div>

              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-warning">Save & Notify Student</button>
                <a href="{% url 'courses:submission_detail' submission.pk %}" class="btn btn-outline-secondary">Cancel</a>
              </div>
            </form>
          </div>
        </div>
      </div>
    {% endif %}
  </div>

  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <p class="small"><strong>Submission meta</strong></p>
        <p class="small">Submission ID: {{ submission.pk }}</p>
        <p class="small">Course: {{ submission.course.title }}</p>
        <p class="small">Student roll: {{ submission.student.roll_number }}</p>
        <p class="small">Previously graded: {% if submission.graded %}Yes ({{ submission.grade }}){% else %}No{% endif %}</p>
      </div>
    </div>
  </div>
</div>

{% endblock %}
